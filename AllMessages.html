<!DOCTYPE html>
<html>
<head>
  <title>All Messages</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>All Messages</h1>
  <div id="nav-buttons">
    <a href="index.html" class="home-button">Home</a>
    <a href="gallery.html" class="gallery-button">Gallery</a>
  </div>
  <div id="all-messages-container">
    <div id="all-messages"></div>
    <div id="input-bar">
      <input type="text" id="name-input" placeholder="Your name..."/>
      <input type="text" id="message-input" placeholder="Type your message..."/>
      <button id="send-button">❤️</button>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      let messages = JSON.parse(localStorage.getItem('messages')) || [];
      const allMessagesDiv = document.getElementById('all-messages');
      const nameInput = document.getElementById('name-input');
      const messageInput = document.getElementById('message-input');
      const sendButton = document.getElementById('send-button');

      function displayAllMessages() {
        allMessagesDiv.innerHTML = '';
        messages.forEach(message => {
          const messageDiv = document.createElement('div');
          messageDiv.className = 'message-box';
          messageDiv.innerHTML = `
            <div class="message-info">
              <span class="message-name">${message.name}</span>
              <span class="message-time">${new Date(message.time).toLocaleString()}</span>
            </div>
            <div class="message-text">${message.message}</div>
          `;
          allMessagesDiv.appendChild(messageDiv);
        });
      }

      sendButton.addEventListener('click', () => {
        const name = nameInput.value.trim();
        const message = messageInput.value.trim();
        if (name && message) {
          const now = new Date();
          messages.push({ name, message, time: now });
          localStorage.setItem('messages', JSON.stringify(messages));
          nameInput.value = '';
          messageInput.value = '';
          displayAllMessages();
          localStorage.setItem('messagesUpdated', Date.now());
        }
      });

      messageInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          event.preventDefault();
          sendButton.click();
        }
      });

      // Event listener to detect changes in localStorage
      window.addEventListener('storage', function(e) {
        if (e.key === 'messagesUpdated') {
          messages = JSON.parse(localStorage.getItem('messages')) || [];
          displayAllMessages();
        }
      });

      // Initial display
      displayAllMessages();
    });
  </script>
</body>
</html>
